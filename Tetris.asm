.MODEL SMALL
.STACK 10000H
.DATA
	C1 DW ?	
	C2 DW ?
	C3 DW ?
	C4 DW ?
	R1 DW ?
	R2 DW ?
	R3 DW ?
	RAND DB ?
	COUNT DB ?
	SCORE DW ?
.CODE
	MAIN PROC
		MOV AX, @DATA
		MOV DS, AX
		
		CALL GRAPHICMODE
		;CALL BACKGROUND
		CALL TOPBOUNDARY
		CALL BOTTOMBOUNDARY
		CALL LEFTBOUNDARY
		CALL RIGHTBOUNDARY
		LOOP1:
			MOV CX, 54
			MOV DX, 45
			L6:
				MOV AH, 0DH
				INT 10H
				CMP AL, 0
				JNE EX
				INC CX
				CMP CX, 251
				JNE L6
			;CALL CHECKROW
		LOOP2:
			CALL RANDOM
			CMP RAND, 0
			JE R
			CMP RAND, 1
			JE Y
			CMP RAND, 2
			JE G
			CMP RAND, 3
			JE P
			JMP LOOP2
		R:
			CALL MOVETRD
			JMP LOOP1
		Y:
			CALL MOVETYEL
			JMP LOOP1
		G:
			CALL MOVETGR
			JMP LOOP1
		P:
			CALL MOVETPR
			JMP LOOP1
		EX:
			CALL EXIT
		MOV AH, 4CH
		INT 21H
	MAIN ENDP
GRAPHICMODE PROC
	MOV AX, 10H
	INT 10H
	RET
GRAPHICMODE ENDP
BACKGROUND PROC
	MOV AH, 0BH
	MOV BX, 9
	INT 10H
	RET
BACKGROUND ENDP
TOPBOUNDARY PROC
	MOV CX, 50
	L1:
		MOV DX, 30
		L2:
			MOV AH, 0CH
			MOV AL, 2
			INT 10H
			INC DX
			CMP DX, 34
			JNE L2
		INC CX
		CMP CX, 255
		JNE L1
	RET
TOPBOUNDARY ENDP
BOTTOMBOUNDARY PROC
	MOV CX, 50
	L1:
		MOV DX, 327
		L2:
			MOV AH, 0CH
			MOV AL, 2
			INT 10H
			INC DX
			CMP DX, 331
			JNE L2
		INC CX
		CMP CX, 255
		JNE L1
	RET
BOTTOMBOUNDARY ENDP
LEFTBOUNDARY PROC
	MOV DX, 30 
	L1:
		MOV CX, 50
		L2:
			MOV AH, 0CH
			MOV AL, 2
			INT 10H
			INC CX
			CMP CX, 54
			JNE L2
		INC DX
		CMP DX, 331
		JNE L1
	RET
LEFTBOUNDARY ENDP
RIGHTBOUNDARY PROC
	MOV DX, 30 
	L1:
		MOV CX, 252
		L2:
			MOV AH, 0CH
			MOV AL, 2
			INT 10H
			INC CX
			CMP CX, 255
			JNE L2
		INC DX
		CMP DX, 331
		JNE L1
	RET
RIGHTBOUNDARY ENDP
INTERNAL PROC
	MOV DX, 34 
	L1:
		MOV CX, 54
		L2:
			MOV AH, 0CH
			MOV AL, 15
			INT 10H
			INC CX
			CMP CX, 251
			JNE L2
		INC DX
		CMP DX, 327
		JNE L1
	RET
INTERNAL ENDP
TETROYEL PROC
	MOV DX, R1
	L1:
		MOV CX, C1
		L2:
			MOV AH, 0CH
			MOV AL, 14
			INT 10H
			INC CX
			CMP CX, C2
			JNE L2
		INC DX
		CMP DX, R2
		JNE L1
	MOV DX, R2
	L3:
		MOV CX, C3
		L4:
			MOV AH, 0CH
			MOV AL, 14
			INT 10H
			INC CX
			CMP CX, C4
			JNE L4
		INC DX
		CMP DX, R3
		JNE L3
	RET
TETROYEL ENDP
REMTYEL PROC
	MOV DX, R1
	L1:
		MOV CX, C1
		L2:
			MOV AH, 0CH
			MOV AL, 0
			INT 10H
			INC CX
			CMP CX, C2
			JNE L2
		INC DX
		CMP DX, R2
		JNE L1
	MOV DX, R2
	L3:
		MOV CX, C3
		L4:
			MOV AH, 0CH
			MOV AL, 0
			INT 10H
			INC CX
			CMP CX, C4
			JNE L4
		INC DX
		CMP DX, R3
		JNE L3
	RET
REMTYEL ENDP
MOVETYEL PROC
	MOV C1, 137
	MOV C2, 170
	MOV C3, 148
	MOV C4, 159
	MOV R1, 34
	MOV R2, 45
	MOV R3, 56
	L1:
		CALL TETROYEL
		CALL DELAY
		CALL REMTYEL
		INC R1
		INC R2
		INC R3
		MOV AH, 1
		INT 16H
		JZ T1
		MOV AH, 0
		INT 16H
		CMP AL, 61H
		JE N1
		CMP AL, 64H
		JE N2
		CMP AL, 41H
		JE N1
		CMP AL, 44H
		JE N2
		CMP AL, 57H
		JE EX
		CMP AL, 77H
		JE EX
		JMP T1
		N1:
			MOV CX, C3
			DEC CX
			MOV DX, R2
			L3:
				MOV AH, 0DH
				INT 10H
				CMP AL, 0
				JNE T1
				INC DX
				CMP DX, R3
				JNE L3
			MOV CX, C1
			DEC CX
			MOV DX, R1
			L4:
				MOV AH, 0DH
				INT 10H
				CMP AL, 0
				JNE T1
				INC DX
				CMP DX, R2
				JNE L4
			DEC C1
			DEC C2
			DEC C3
			DEC C4
			JMP T1
		N2:
			MOV CX, C4
			MOV DX, R2
			L7:
				MOV AH, 0DH
				INT 10H
				CMP AL, 0
				JNE T1
				INC DX
				CMP DX, R3
				JNE L7
			MOV CX, C2
			MOV DX, R1
			L8:
				MOV AH, 0DH
				INT 10H
				CMP AL, 0
				JNE T1
				INC DX
				CMP DX, R2
				JNE L8
			INC C1
			INC C2
			INC C3
			INC C4
		T1:
		MOV CX, C1
		MOV DX, R2
		L5:
			MOV AH, 0DH
			INT 10H
			CMP AL, 0
			JNE RTN
			INC CX
			CMP CX, C3
			JNE L5
		MOV CX, C4
		MOV DX, R2
		L6:
			MOV AH, 0DH
			INT 10H
			CMP AL, 0
			JNE RTN
			INC CX
			CMP CX, C2
			JNE L6
		MOV CX, C3
		MOV DX, R3
		L2:
			MOV AH, 0DH
			INT 10H
			CMP AL, 0
			JNE RTN
			INC CX
			CMP CX, C4
			JNE L2
		JMP L1
	RTN:
		CALL TETROYEL
		RET
	EX:
		CALL EXIT
MOVETYEL ENDP
TETROPR PROC
	MOV DX, R1
	L1:
		MOV CX, C1
		L2:
			MOV AH, 0CH
			MOV AL, 5
			INT 10H
			INC CX
			CMP CX, C2
			JNE L2
		INC DX
		CMP DX, R2
		JNE L1
	MOV DX, R2
	L3:
		MOV CX, C3
		L4:
			MOV AH, 0CH
			MOV AL, 5
			INT 10H
			INC CX
			CMP CX, C2
			JNE L4
		INC DX
		CMP DX, R3
		JNE L3	
	RET
TETROPR ENDP
REMTPR PROC
	MOV DX, R1
	L1:
		MOV CX, C1
		L2:
			MOV AH, 0CH
			MOV AL, 0
			INT 10H
			INC CX
			CMP CX, C2
			JNE L2
		INC DX
		CMP DX, R2
		JNE L1
	MOV DX, R2
	L3:
		MOV CX, C3
		L4:
			MOV AH, 0CH
			MOV AL, 0
			INT 10H
			INC CX
			CMP CX, C2
			JNE L4
		INC DX
		CMP DX, R3
		JNE L3	
	RET
REMTPR ENDP
MOVETPR PROC
	MOV C1, 137
	MOV C2, 170
	MOV C3, 159
	MOV R1, 34
	MOV R2, 45
	MOV R3, 56
	L1:
		CALL TETROPR
		CALL DELAY
		CALL REMTPR
		INC R1
		INC R2
		INC R3
		MOV AH, 1
		INT 16H
		JZ T1
		MOV AH, 0
		INT 16H
		CMP AL, 61H
		JE N1
		CMP AL, 64H
		JE N2
		CMP AL, 41H
		JE N1
		CMP AL, 44H
		JE N2
		CMP AL, 57H
		JE EX
		CMP AL, 77H
		JE EX
		JMP T1
		N1:
			MOV CX, C3
			DEC CX
			MOV DX, R2
			L3:
				MOV AH, 0DH
				INT 10H
				CMP AL, 0
				JNE T1
				INC DX
				CMP DX, R3
				JNE L3
			MOV CX, C1
			DEC CX
			MOV DX, R1
			L4:
				MOV AH, 0DH
				INT 10H
				CMP AL, 0
				JNE T1
				INC DX
				CMP DX, R2
				JNE L4
			DEC C1
			DEC C2
			DEC C3
			JMP T1
		N2:
			MOV CX, C2
			MOV DX, R1
			L6:
				MOV AH, 0DH
				INT 10H
				CMP AL, 0
				JNE T1
				INC DX
				CMP DX, R3
				JNE L6
			INC C1
			INC C2
			INC C3
		T1:
		MOV CX, C1
		MOV DX, R2
		L5:
			MOV AH, 0DH
			INT 10H
			CMP AL, 0
			JNE RTN
			INC CX
			CMP CX, C3
			JNE L5
		MOV CX, C3
		MOV DX, R3
		L2:
			MOV AH, 0DH
			INT 10H
			CMP AL, 0
			JNE RTN
			INC CX
			CMP CX, C2
			JNE L2
		JMP L1
	RTN:
		CALL TETROPR
		RET
	EX:
		CALL EXIT
MOVETPR ENDP
TETROGR PROC
	MOV DX, R1
	L1:
		MOV CX, C1
		L2:
			MOV AH, 0CH
			MOV AL, 10
			INT 10H
			INC CX
			CMP CX, C2
			JNE L2
		INC DX
		CMP DX, R2
		JNE L1
	MOV DX, R2
	L3:
		MOV CX, C1
		L4:
			MOV AH, 0CH
			MOV AL, 10
			INT 10H
			INC CX
			CMP CX, C3
			JNE L4
		INC DX
		CMP DX, R3
		JNE L3	
	RET
TETROGR ENDP
REMTGR PROC
	MOV DX, R1
	L1:
		MOV CX, C1
		L2:
			MOV AH, 0CH
			MOV AL, 0
			INT 10H
			INC CX
			CMP CX, C2
			JNE L2
		INC DX
		CMP DX, R2
		JNE L1
	MOV DX, R2
	L3:
		MOV CX, C1
		L4:
			MOV AH, 0CH
			MOV AL, 0
			INT 10H
			INC CX
			CMP CX, C3
			JNE L4
		INC DX
		CMP DX, R3
		JNE L3
	RET
REMTGR ENDP
MOVETGR PROC
	MOV C1, 137
	MOV C2, 170
	MOV C3, 148
	MOV R1, 34
	MOV R2, 45
	MOV R3, 56
	L1:
		CALL TETROGR
		CALL DELAY
		CALL REMTGR
		INC R1
		INC R2
		INC R3
		MOV AH, 1
		INT 16H
		JZ T1
		MOV AH, 0
		INT 16H
		CMP AL, 61H
		JE N1
		CMP AL, 64H
		JE N2
		CMP AL, 41H
		JE N1
		CMP AL, 44H
		JE N2
		CMP AL, 57H
		JE EX
		CMP AL, 77H
		JE EX
		JMP T1
		N1:
			MOV CX, C1
			DEC CX
			MOV DX, R1
			L4:
				MOV AH, 0DH
				INT 10H
				CMP AL, 0
				JNE T1
				INC DX
				CMP DX, R3
				JNE L4
			DEC C1
			DEC C2
			DEC C3
			JMP T1
		N2:
			MOV CX, C3
			MOV DX, R2
			L7:
				MOV AH, 0DH
				INT 10H
				CMP AL, 0
				JNE T1
				INC DX
				CMP DX, R3
				JNE L7
			MOV CX, C2
			MOV DX, R1
			L8:
				MOV AH, 0DH
				INT 10H
				CMP AL, 0
				JNE T1
				INC DX
				CMP DX, R2
				JNE L8
			INC C1
			INC C2
			INC C3
		T1:
		MOV CX, C3
		MOV DX, R2
		L5:
			MOV AH, 0DH
			INT 10H
			CMP AL, 0
			JNE RTN
			INC CX
			CMP CX, C2
			JNE L5
		MOV CX, C1
		MOV DX, R3
		L2:
			MOV AH, 0DH
			INT 10H
			CMP AL, 0
			JNE RTN
			INC CX
			CMP CX, C3
			JNE L2
		JMP L1
	RTN:
		CALL TETROGR
		RET
	EX:
		CALL EXIT
MOVETGR ENDP
TETRORD PROC
	MOV DX, R1
	L1:
		MOV CX, C1
		L2:
			MOV AH, 0CH
			MOV AL, 4
			INT 10H
			INC CX
			CMP CX, C2
			JNE L2
		INC DX
		CMP DX, R2
		JNE L1
	RET
TETRORD ENDP
REMTRD PROC
	MOV DX, R1
	L1:
		MOV CX, C1
		L2:
			MOV AH, 0CH
			MOV AL, 0
			INT 10H
			INC CX
			CMP CX, C2
			JNE L2
		INC DX
		CMP DX, R2
		JNE L1
	MOV DX, R2
	RET
REMTRD ENDP
MOVETRD PROC
	MOV C1, 137
	MOV C2, 170
	MOV R1, 34
	MOV R2, 45
	L1:
		CALL TETRORD
		CALL DELAY
		CALL REMTRD
		INC R1
		INC R2
		MOV AH, 1
		INT 16H
		JZ T1
		MOV AH, 0
		INT 16H
		CMP AL, 61H
		JE N1
		CMP AL, 64H
		JE N2
		CMP AL, 41H
		JE N1
		CMP AL, 44H
		JE N2
		CMP AL, 51H
		JE EX
		CMP AL, 71H
		JE EX
		JMP T1
		N1:
			MOV CX, C1
			DEC CX
			MOV DX, R1
			L4:
				MOV AH, 0DH
				INT 10H
				CMP AL, 0
				JNE T1
				INC DX
				CMP DX, R2
				JNE L4
			DEC C1
			DEC C2
			JMP T1
		N2:
			MOV CX, C2
			MOV DX, R1
			L3:
				MOV AH, 0DH
				INT 10H
				CMP AL, 0
				JNE T1
				INC DX
				CMP DX, R2
				JNE L3
			INC C1
			INC C2
		T1:
		MOV CX, C1
		MOV DX, R2
		L2:
			MOV AH, 0DH
			INT 10H
			CMP AL, 0
			JNE RTN
			INC CX
			CMP CX, C2
			JNE L2
		JMP L1
	RTN:
		CALL TETRORD
		RET
	EX:
		CALL EXIT
MOVETRD ENDP
DELAY PROC
	MOV CX, 1H
	MOV DX, 0H
	MOV AH, 86H
	INT 15H
	RET
DELAY ENDP
RANDOM PROC
	PUSH AX
	PUSH BX
	PUSH CX
	PUSH DX
	MOV AH, 2CH
	INT 21H
	AND DL, 00000011B
	MOV RAND, DL
	POP DX
	POP CX 
	POP BX	
	POP AX
	RET
RANDOM ENDP
EXIT PROC
	MOV AH, 0
    MOV AL, 2
    INT 10h
	MOV AX, 4C00H
    INT 21H
	RET
EXIT ENDP
CHECKROW PROC
	MOV R1, 41
	MOV R2, 52
	MOV COUNT, 26
	L1:
		MOV CX, 54
		L2:
			MOV DX, R1
			L3:
				MOV AH, 0DH
				INT 10H
				CMP AL, 0
				JNE T1
				INC DX
				CMP DX, R2
				JNE L3
			INC CX
			CMP CX, 251
			JNE L2
		MOV CX, 250
		L6:
			MOV DX, R1
			DEC DX
			L7:
				MOV AH, 0DH
				INT 10H
				MOV AH, 0
				PUSH AX
				DEC DX
				CMP DX, 33
				JNE L7
			DEC CX
			CMP CX, 53
			JNE L6
		MOV CX, 54
		L4:
			MOV DX, R1
			L5:
				MOV AH, 0CH
				MOV AL, 0
				INT 10H
				INC DX
				CMP DX, R2
				JNE L5
			INC CX
			CMP CX, 251
			JNE L4
		MOV CX, 54
		L8:
			MOV DX, 45
			DEC DX
			L9:
				MOV AH, 0CH
				POP BX
				MOV AL, BL
				INT 10H
				DEC DX
				CMP DX, R2
				JNE L8
			DEC CX
			CMP CX, 251
			JNE L9
		ADD SCORE, 10
		T1:
			ADD R1, 11
			ADD R2, 11
			DEC COUNT
			JNZ L1
CHECKROW ENDP
END MAIN